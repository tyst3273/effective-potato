
# --------------------------------------------------------------------------------------------------
# rutile TiO2 WITHOUT electric field
# NOTE: according to wikipedia, rutile melts at ~2200 K


# --------------------------------------------------------------------------------------------------
# define simulation domain
# --------------------------------------------------------------------------------------------------

units           metal
dimension       3
newton          on
boundary        p p p 
atom_style      charge

neighbor        2.0 bin
neigh_modify    every 100 delay 100 check yes

# --------------------------------------------------------------------------------------------------
# define simulation paramters
# --------------------------------------------------------------------------------------------------

variable        dt equal    0.001         # timestep
variable	t_start     equal 1000       
variable        t_stop      equal 1e-6

variable        seed equal 864215

variable        therm_run equal 500    # thermalize at T
variable        quench_run equal 500   # equilibrate at T
variable        init_damp_run equal 100
variable        final_damp_run equal 500

variable        trj_dump equal 10
variable        thermo_dump equal 10

variable        charge_min_damp equal 10
variable        charge_min equal 100

# --------------------------------------------------------------------------------------------------
# define crystal
# -------------------------------------------------------------------------------------------------- 

read_data       lammps.pos

mass            1 47.867
mass            2 15.999

compute         charge all  property/atom q

# --------------------------------------------------------------------------------------------------
# define potential
# --------------------------------------------------------------------------------------------------

pair_style      comb3 polar_off
pair_coeff      * * ffield.comb3 Ti O

# --------------------------------------------------------------------------------------------------
# set some more params
# --------------------------------------------------------------------------------------------------

timestep        ${dt}
reset_timestep  0

thermo          ${thermo_dump}
thermo_style    custom step etotal temp pe press pxx pyy pzz fmax lx ly lz 

dump            TRJ all custom ${trj_dump} sim.lammpstrj id type x y z
dump_modify     TRJ sort id

# --------------------------------------------------------------------------------------------------
# charge equilibralizer and efield
# --------------------------------------------------------------------------------------------------

fix             QEQ all qeq/comb ${charge_min_damp} 0.01 file qeq.out

fix             EFIELD all efield 0.0 0.1 0.0


# --------------------------------------------------------------------------------------------------
# large damping coeff; keep system from 'blowing up' if bad initial config
# --------------------------------------------------------------------------------------------------

fix             NVE all nve
fix             VISCOUS all viscous 0.75
run             ${init_damp_run}
unfix           VISCOUS
unfix           NVE

# --------------------------------------------------------------------------------------------------
# thermalize
# --------------------------------------------------------------------------------------------------

# reset how often minimization is done to save time
unfix           QEQ
fix             QEQ all qeq/comb ${charge_min} 1e-3 file qeq.out

velocity        all create ${t_start} ${seed} mom yes rot yes dist gaussian

fix             THERM all npt temp ${t_start} ${t_start} $(100.0*dt) iso 0.0 0.0 $(1000.0*dt) 
run             ${therm_run}
unfix           THERM

# --------------------------------------------------------------------------------------------------
# quench and ~slowly damp out KE; put system in local minimum of PE surface
# --------------------------------------------------------------------------------------------------

fix             QUENCH all npt temp ${t_start} ${t_stop} $(100.0*dt) iso 0.0 0.0 $(1000.0*dt)
run             ${quench_run}
unfix           QUENCH

# refix it to find correct minimum
unfix           QEQ
fix             QEQ all qeq/comb ${charge_min_damp} 1e-3 file qeq.out

fix             NVE all nve
fix             VISCOUS all viscous 0.1
run             ${final_damp_run}
unfix           VISCOUS
unfix           NVE

# --------------------------------------------------------------------------------------------------
# write stuff out
# --------------------------------------------------------------------------------------------------

dump            FORCES all custom 1 forces.final id fx fy fz
dump_modify     FORCES format float "%20.15f"
dump_modify     FORCES sort id

dump            POSITIONS all custom 1 positions.final id type xs ys zs
dump_modify     POSITIONS format float "%20.15f"
dump_modify     POSITIONS sort id

dump            CHARGES all custom 1 charges.final id type q
dump_modify     CHARGES format float "%10.6f"
dump_modify     CHARGES sort id

fix             WRITE all nve
run             0
unfix           WRITE

undump          FORCES
undump          POSITIONS
undump          TRJ
undump          CHARGES

write_data      relaxed.pos




